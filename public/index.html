<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Socket</title>
  <script src="socket.io/socket.io.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/vue@2/dist/vue.js"></script>
</head>
<body>

    <h1>Socket</h1>

    <div id="app">

      <div v-if="!error">
        <h2>
          HP: {{ health }}
        </h2>
  
        <button @click="attack">
          Atacar
        </button>
      </div>

      <p v-if="error">
        {{ error }}
      </p>

    </div>

    <script>

      const socket = io.connect()

      const app = new Vue({
        el: '#app',
        data: {
          error: '',
          health: 200,
        },

        methods: {
          damage: function () {
            this.health -= 10;

            if(this.health <= 0){
              socket.emit('logout')
              alert('Você perdeu')
            }
          },
          attack: function(){
            socket.emit('attack')
          }
        },

        mounted(){

          // First event in connection (default)
          socket.on('connect', () => {
            console.log("Conectado à", socket.room)
          })

          // Inflinct damage in the player
          socket.on('damage', () => {
            this.damage()
          })

          // When you win a battle
          socket.on('win', (socket) => {
            alert('Você venceu')
          })

          //failToEnter
          socket.on('failToEnter', (socket) => {
            this.error = 'Falha ao conectar. A sala esta cheia, desculpe'
          })
        }
      })

    </script>
</body>
</html>